<div class="pollution-recap-container">
  <div class="header">
    <h2>ğŸ“ˆ RÃ©capitulatif des Pollutions</h2>
    <div class="header-actions">
      <button class="btn btn-primary" routerLink="/pollutions/create">â• Nouvelle Pollution</button>
      <button class="btn btn-secondary" routerLink="/pollutions/list">ğŸ“‹ Voir la liste</button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading">Chargement des statistiques...</div>
  } @else {
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
          <h3>{{ stats().totalDeclarations }}</h3>
          <p>Total des pollutions</p>
        </div>
      </div>

      @for (level of pollutionLevel; track level) {
        <div
          class="stat-card"
          [ngClass]="{ faible: level === 'Faible', moyen: level === 'Moyen', eleve: level === 'Ã‰levÃ©' }"
        >
          <div class="stat-icon">
            {{ level === 'Faible' ? 'âœ…' : level === 'Moyen' ? 'âš ï¸' : 'ğŸš¨' }}
          </div>
          <div class="stat-info">
            <h3>{{ stats().declarationsBySeverity[level] }}</h3>
            <p>Niveau {{ level.toLowerCase() }}</p>
          </div>
        </div>
      }
    </div>

    @for (type of pollutionType; track type) {
      <div class="stats-grid">
        <div class="stat-card type-card">
          <div class="stat-icon">ğŸ—‘ï¸</div>
          <div class="stat-info">
            <h3>{{ stats().declarationsByType[type] }}</h3>
            <p>Type: {{ type }}</p>
          </div>
        </div>
      </div>
    }

    @if (pollutions().length > 0) {
      <div class="recent-pollutions">
        <h3>ğŸ“‹ Pollutions RÃ©centes</h3>
        <div class="pollution-list">
          @for (pollution of pollutions() | slice: 0 : 5; track pollution.id) {
            <div class="pollution-item">
              <div class="pollution-info">
                <h4>{{ pollution.titre }}</h4>
                <p>
                  {{ pollution.adresse || 'GPS: ' + pollution.latitude + ', ' + pollution.longitude }} -
                  {{ pollution.dateObservation | date: 'shortDate' }}
                </p>
              </div>
              <span class="severity-badge" [class]="'severity-' + pollution.niveau">
                {{ pollution.niveau }}
              </span>
              <button class="btn btn-info" [routerLink]="['/pollutions/detail', pollution.id]">ğŸ‘ï¸ Voir</button>
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="no-data">
        <p>Aucune pollution enregistrÃ©e</p>
        <button class="btn btn-primary" routerLink="/pollutions/create">CrÃ©er la premiÃ¨re pollution</button>
      </div>
    }
  }
</div>
